test_that("likelihoodfunction for mnormal generation ", {
  
  model <- Y ~ X
  x1 <- c(2,5,7,3,1,6,7,9)
  x2 <- c(3,4,7,8,3,4,5,7)
  X <- matrix(data = c(x1,x2), ncol=2)
  Y <- 0.3*(3*x1 + 4*x2) + 0.7*(2*x1 + 5*x2)
  lfmn <- FamilyMNormal$new(Y, X, latent=2)
  d <- matrix(c(c(0,0,0,1,0,1,0,0),c(1,1,1,0,1,0,1,1)), nrow=8,ncol=2)
  theta <- c(0.3,0.7,1,1,3,4,2,5)
  lf_g <- lfmn$gen_ll()
  expect_match(class(lf_g), "function")
  k <- lf_g(theta=theta,d=d)
  print(k)
  expect_equal(k, 20, tolerance=0.5)
})

test_that("generate_gr", {
  x1 <- rnorm(1000, mean=1, sd=1)
  x2 <- rnorm(1000, mean=1, sd=1)
  e <- rnorm(1000, mean=0, sd=1)
  Y <- 0.3*(3*x1 + 4*x2) + 0.7*(2*x1 + 5*x2)
  X <- matrix(data = c(x1,x2), ncol=2)
  theta <- c(0.3,0.7,1,1,3,4,2,5)
  lfn <- FamilyMNormal$new(Y, X, latent=2)
  rd <-  runif(n=1000,min=0,max=1)
  d <-  matrix(c(rd,(1-rd)),ncol=2)
  ll <- lfn$get_ll()
  expect_match(class(ll), "function")
  print(ll(theta, d))
  ll2 <- partial(ll, d=d)
  gr <- gen_gr(ll2)
  expect_match(class(gr), "function")
  print(gr)

  print(gr(theta))
})